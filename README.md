Система управления и конроля доступом
=====================================
Описание системы
----------------

Есть систему контроля доступа в помещение, есть клавиатура с помощью которой вводится код для доступа, есть сигнализация которая активируетсся после 3х неправильных попыток, так же есть центральный пункт с которого можно поменять пароль на любой двери и отключить сигнализацию.


Система работает на связке микроконтроллеров серии STM32F103C8T6 соединенных по интерфейсу SPI.


Есть микропроцессорный блок центрального пункта(MASTER), есть микропроцессорного блок контроля доступа в помещение(SLAVE). С master можно: отправить сигнал для открытия slave; отправить сигнал смены пароля; отправить сигнал отключения сигнализации. 



С slave можно ввести пароль откртия замка либо нажать спец. кнопку для открытися замка.


Алгоритм работы master:
-----------------------

После запуска программы система переходит в режим ожидания. Существует несколько триггеров для вывода системы из этого состояния. Первый триггер – нажатие кнопки смены пароля. В этом случае происходит ввод нового пароля и передача данных через SPI. Второй триггер – это нажатие кнопки отключение сигнализации. В этом случае происходит отключение сигнализации. Программа возвращается в исходное состояние.

![Алгоритм мастер](/algoritm_master.png "Алгоритм мастер")


Алгоритм работы slave:
----------------------

1. контроллер ждет сигнал -> 2 пункт.

2. нажали кнопку ввода, обнуляется счетчик неправильных ответов, загорается индикация что замок закрыт -> 3 пункт
 
/ сигнал от главного МК -> 10 пункт.

3. вводим цифры, контроллер проверяет буфер сравнивая с правильным ответом  -> 4 пункт.

4. если комбинация правильная -> 5 пункт 

/ неправильная -> 6 пункт.

5. посылается сигнал на открытие замка и запускается таймер, по истечению которого дверь снова закроется и перейдет в режим ожидания, загорается индикация что замок открыт -> 1 пункт.

6. если значение счетчика неправильных ответов меньше определенного числа -> 7 пункт
 
/ равно определенному числу -> 8 пункт.

7. значение счетчика неправильных ответов увеличивается на один -> 3 пункт.

8. запускается сигнализация -> 9 пункт.

9. с главного МК приходит сигнал отключения сигнализации -> пункт 1.

10. если сигнал открытия замка -> 5 пункт 

/ если сигнал смена пароля -> 11 пункт.

11. присваивается значение нового пароля, контроллер переходит в обычный режим -> 1 пункт. 




Схема подключения выводов к микроконтроллеру STM32F103C8T6
==========================================================
Для обоих МК подключения кнопок клавиатуры соотвествует следующему принципу: пин = № цифры


PB11=1
PB10=2
PB1= 3
PC14=4
PB5= 5
PB6= 6
PB8= 7
PB0= 8
PB4= 9
PB7= 0


Для MASTER:
-----------

PB9 - смена пароля.


PC15 - отключение сигнализации.


![мастер](/master_zamok.png "мастер")



Для SLAVE:
-----------


PB9 - нажимается после ввода пароля для его проверки на правильность.


PC15 - открытие замка.


![zamok](/zamok.png "zamok")



